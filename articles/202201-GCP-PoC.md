# gcp的一个poc

## 无心插柳柳成荫
2021年初冬的一个不算太忙的下午，我还在楼上阁楼接到同事a一个兴高采烈的电话。\
a是一位硬核的devops工程师，她先问的我，“你的python技能怎么样？” \
我心里是有点虚的，很怕她问我一些oop，unit test这些没接触过的经历，实话实说：“我不算团队中代码最强的，之前用python写过一些etl”\
她倒倒是很兴奋：“我们有一个项目给外国一家银行做一个预警系统，在gcp平台使用nlp技术，自动识别新闻中的负面观点，并提供预警给风险管理部。加入我们吧，和谷歌一起合作，会有谷歌的专家给我们一些expert opinion的！”\
我一开始有点担心自己混不下去这类devops的项目，横竖当前也没别的项目可以参与，便也欣然答应了下来.\
\

几个礼拜的poc做下来，系统大概成型：
1. gcp cloud storage上传pdf/docx/refinitiv news
2. 上传动作触发gcp cloud function，对文本进行提取，将文本以json文件格式发给pub/sub message queue
3. 将以上步骤的文字拆分为段落，再次将文本以json文件格式发给pub/sub message queue
4. pub/sub再次触发新的gcp cloud function，使用google nlp api获取文本中的情感（sentiment）【-1，1】
5. 将结果（情感得分），标题，日期，渠道等字段写入google bigquery
6. 使用looker软件连接google bigquery 展现分析结果


不都一一赘述，写几个自己觉得震撼的地方：

## takeaways - bigquery
**repeated fields** \
In traditional data warehouses, take a retail store as example, there are fact tables (eg. sales transcations) and dimensions tables (eg. customers, products, orders). 
Before this project, I thought this is the ONLY way for data warehouses.
In bigquery, you can actually only have 1 fact table and save those dimension tables into nested fields. When query fields from both base table and the nested field, you can unnest and cross join them: \

**placeholder for code snippet**


## looker
**一个带git的bi工具** \
**lookerml**虽然没有想象的那么ml，却已经可以处理自动unnest bigquery repeated fields\
**Content Validator**
批量替代

## automated deployment


## 项目管理
项目8周，分成4个spint，前三个用于研发，最后

**测试** 
更加积极主动的进程汇报，可以是邮件问清楚测试的预期，而不是等到一周2次汇报的时候，顾客当场说signal irrelvant

